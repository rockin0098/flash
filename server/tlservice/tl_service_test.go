package tlservice

import (
	"encoding/hex"
	"testing"

	"github.com/rockin0098/meow/proto/mtproto"
)

func TestMessageProcess(t *testing.T) {

	authKeyID := int64(-4305667832853861188)
	msgbytes, _ := hex.DecodeString("bc6ceb1deb313fc4abb15ab8ab3947904cc0a83e452f13b775847933decd5f34538c1596eb0afdcf31a5081f5d67f3bd9e0772950dc60cdf194c25c18b2102793ecf1c7aacd15788ed89dd92405f5a2c0bb549886b932e0db8179593dcb029b8726dd9327185dd998e933179677b9c1950fdbbbc3655cbf1d7177dcbae5803f7250d4d36441372d3bd16f9cf589d6484fb7ed3cf2d81652b24fd9ed987f070554cd74f1e8b2fd39cfae72e05f63dfe18e6ddbafb2a0648c0f8ef696581525efcb348b77e0a6df55418401b87c72feffb52ce0fc3afe104de0c238067a51371cf65a615208242446b3d2f34617615729c71d00810b60d266bfe9bd7d3293bd1cf68b5142ef7ffef66f2da67224ad30f1c27a99028c1a45824875f001509c3ff1a9d91f867c8ff2efcb03b8dcd644de4f6fac956bb29079ebfac539e04001c3f45d5c842b4f2893bb5a56cb96f304f4be47dec261a4facf670d40a3c7b3516e7c2ea97563a4f640f44a82945a824d7900b7fd0268a39fdaab6333cd50387f9d569b2b4d4891d48521be69082b350fa7b99cf49174acce2bcd2984587723c185564e5171c73c58f1591f36e1697ad57162df5a60c6dd8c4913c7e5cd16dfb3a9227c9b1596f33ecb2eddfd9f43a547ad13473262baa3d96db45a1dd90c6d60e7737010949657a66b8d34943982c3212aa80edd02a31844c4f3428257593d7adb1374e95e5833cff0bdc6f557476dd8886f0fcd985b5238bec52356f37736295e53510f9aa048e342c1ad90f8ccf9e1539ebeb06bfe534c8362a291d97ff4f51fd8b5ea21d5e5ff3d3de464fd75eb69664519af25492f3055105c7b358f212ddec7c5f4e7d9365f1fef4586b5764830fbbc80847307933eee888")

	message := mtproto.NewRawMessage(0, authKeyID, 0)
	message.Decode(msgbytes)

	raw := message

	authid := raw.AuthKeyID
	akey, _ := hex.DecodeString("1bc72cf5e5e7c456fd7113abdd7ed179e940c71488c924d5784e53651e7d5070a0a0c93c6f2c8cc855b51a9ac015f008a9c2bcc17b5ce0eb65f611eb208a65278fbc51d30184584c136e800b385810b6f73535021282ecfc6d1ce087899ab975e03e30a476d24348cd7c1fb711082788b9dcc7b0c808f5e14ae78f8c4ce4fd066ce6acf49291d1d6f9c3340ae97d7beb906fe02afcb9018e68c7d60a7eea7d713f9a42382453f96c60f486502603d0a5c2c775e5f5d1f97abc9720c183cfd12b37a89d45020db362163bb333b8b88eea31dd99c4f904e22e109cdf71831d649a9295e46a514ce19a09bd69fb67fae9aff8453ceff2f64e55a6b206aaa157c997")
	if akey == nil {
		Log.Error("authkey not found by authid=%v", authid)
		return
	}

	reqmsg := &mtproto.EncryptedMessage{
		AuthKeyID: authid,
	}
	err := reqmsg.Decode(akey, raw.Payload[8:])
	if err != nil {
		Log.Error(err)
		return
	}
}
